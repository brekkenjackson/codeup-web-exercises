<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Map Marker Example</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <!-- Mapbox CSS -->
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.css' rel='stylesheet' />
    <!-- Custom CSS -->
    <style>
        html, body {
            background-image: url('https://i.gifer.com/ZN2f.gif')
        }

        #map {
            /* the width and height may be set to any size */
            display: flex;
            width: 100%;
            height: 420px;}

        h1 {
            display: flex;
            justify-content: center;
            margin-top: .5em;
            color: #3B94D9;
            font-size: 45px;
        }

        #btn-units {
            float: right;
            margin-bottom: 1em;
            margin-right: 1em;
        }

        #cards-div {
            display: flex;
            justify-content: space-between;
        }

        #search-bar {
            width: 350px;
            margin: 1em 0;
        }
    </style>
</head>
<body>

<h1>Bjack Weather Map</h1>

    <div id="search-bar" class="container-fluid">
        <form class="d-flex" role="search">
            <input class="form-control me-2" type="search" placeholder="Desired Location..." aria-label="Search">
            <button class="btn btn-outline-dark" type="submit">Search</button>
        </form>
    </div>

<!--<button type="button" class="btn btn-dark" id="btn-units">F째/C째</button>-->

<div class="container-fluid" id="cards-div">
    <div class="card border-light mb-3" style="width: 16rem; height: 13rem;">
        <div class="card-header">Monday</div>
        <div class="card-body text-secondary">
    <!--        <h5 class="card-title">Primary card title</h5>-->
            <p class="card-text"></p>
        </div>
    </div>
    <div class="card border-light mb-3" style="width: 16rem; height: 13rem;">
        <div class="card-header">Tuesday</div>
        <div class="card-body text-secondary">
            <!--        <h5 class="card-title">Primary card title</h5>-->
            <p class="card-text">"If You Master One, That's Cause For Celebration." - Zenitsu Agasuma</p>
        </div>
    </div>
    <div class="card border-light mb-3" style="width: 16rem; height: 13rem;">
        <div class="card-header">Wednesday</div>
        <div class="card-body text-secondary">
            <!--        <h5 class="card-title">Primary card title</h5>-->
            <p class="card-text">"If You Master One, That's Cause For Celebration." - Zenitsu Agasuma</p>
        </div>
    </div>
    <div class="card border-light mb-3" style="width: 16rem; height: 13rem;">
        <div class="card-header">Thursday</div>
        <div class="card-body text-secondary">
            <!--        <h5 class="card-title">Primary card title</h5>-->
            <p class="card-text">"If You Master One, That's Cause For Celebration." - Zenitsu Agasuma</p>
        </div>
    </div>
    <div class="card border-light mb-3" style="width: 16rem; height: 13rem;">
        <div class="card-header">Friday</div>
        <div class="card-body text-secondary">
            <!--        <h5 class="card-title">Primary card title</h5>-->
            <p class="card-text">"If You Master One, That's Cause For Celebration." - Zenitsu Agasuma</p>
        </div>
    </div>
</div>

<!-- The HTML element that serves as the Mapbox container -->
<div id='map'></div>


<!-- Mapbox JS -->
<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.js'></script>

<script src="js/mapbox-geocoder-utils.js"></script>

<!-- Custom JS -->
<script src="js/keys.js"> </script>
<script>

        // prepare the query parameters to identify us to openweather
// and give it our weather query
        let queryParams = new URLSearchParams({
            APPID: WEATHERMAP_API_KEY,
            lat:    29.423017,
            lon:   -98.48527,
            units: "imperial"
        });
// concat the query parameters onto the URL
//         fetch("https://api.openweathermap.org/data/2.5/onecall?lat=29.423017&lon=139&appid=652a58aab8a41fa442961f30c5702ee8" + queryParams, {
//                 method: "GET"
//             }
//         ).then(async function(response) {
//             // use await to wait for the json data and then do something with it
//             const data = await response.json();
//             console.log('The entire response:', data);
//             console.log('Diving in - here is current information: ', data.current);
//             console.log('A step further - information for tomorrow: ', data.daily[1]);
//         });

        mapboxgl.accessToken = MAPBOX_API_KEY;

        let map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/navigation-night-v1',
            zoom: 10,
            center: [-98.4916, 29.4252]
        });


function updateWeather (coords) {
    let url = `https://api.openweathermap.org/data/2.5/onecall?${coords}`
    fetch(url)
        .then(function(response) {
            return response.json();
        }).then(function(data) {
        console.log(data);

        let cardInfo = document.querySelector("#cards-div")
        html = ""
        for (let i = 0; i < 5; i++) {
            let date = new Date(data.daily[i].dt * 1000)
            html += `
 <div class="card border-light mb-3" style="width: 16rem; height: 13rem;">
        <div class="card-header">${date.getDay()}</div>
        <div class="card-body text-secondary">
            <p class="card-text">${data.daily[i].temp.min.toFixed(0)}째F / ${data.daily[i].temp.max.toFixed(0)}째F</p>
            <p>${data.daily[i].weather[0].description}</p>
        </div>
    </div>
`
        }
        cardInfo.innerHTML = html;
    });

}
updateWeather(queryParams);



    let marker = new mapboxgl.Marker(
        {
            draggable:true
        }
    )
        .setLngLat([-98.4916, 29.4260])
        .addTo(map);

    function onDragEnd (){
        let longi = marker.getLngLat().lng;
        let latit = marker.getLngLat().lat;
        let draggedMarker = new URLSearchParams({
            APPID: WEATHERMAP_API_KEY,
            lat: latit,
            lon: longi,
            units: "imperial"
        })
        updateWeather(draggedMarker)
    }

    marker.on('dragend', onDragEnd)

</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>

</body>
</html>